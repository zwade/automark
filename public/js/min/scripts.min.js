var columns=[$("#col1"),$("#col2"),$("#col3")],numCards=0,bookmarkURL=$("#new-url"),tabs=$(".tabs"),datePicker=$(".datepicker"),searchIcon=$("#search"),searchTerm=$("#search-term"),urlRegEx=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.!\/\\\w]*))?)/g,modalSave=$("#save-bookmark"),modalSaveContainer=$("#modal-add"),modalSaveProgress=modalSaveContainer.find(".progress"),modalImport=$("#modal-import"),modalImportYes=$("#import-yes"),modalSettings=$("#modal-settings"),settingAutomatic=$("#automatic-quantity"),settingAlgorithm=$("#sorting-algorithm"),settingNumber=$("#folder-quantity"),addCard=function(e,a,o){var t="<img src='"+a+"'/>";void 0===a&&(t='<div class="bookmark-icon"><i class="mdi-action-bookmark-outline"></i></div>'),columns[numCards%3].append("<a href='"+o+"' target='_blank'><div class='card small'><div class='card-image fill-card'>"+t+"<span class='card-title'>"+e+"</span></div></div></a>");var s=columns[numCards%3].children().last().children();s.scrollfire({onBottomIn:function(e){$(e).addClass("active")}}).scrollfire({onBottomHidden:function(e){$(e).removeClass("active")}});var l=$(window);l.scrollTop()+l.height()>=s.offset().top&&s.addClass("active"),numCards++},addCards=function(e){e.forEach(function(e){addCard(e[0],e[1],e[2])})},addCategory=function(e,a){$("#"+a).append("<li><a class='"+a+"' type='"+e+"' href='#"+e+"'>"+e+"</a></li>")},removeCards=function(){numCards=0,columns.forEach(function(e){e.empty()})},validateURL=function(){!modalSaveProgress.hasClass("active")&&bookmarkURL.val().match(urlRegEx)?modalSave.removeClass("disabled"):modalSave.addClass("disabled")},importBookmarks=function(){modalImport.find(".modal-content").html("<h4>Importing Bookmarks</h4>"),modalImport.find(".progress").addClass("active"),modalImportYes.addClass("disabled")},resetImportModal=function(){modalImport.find(".modal-content").html("<h4>Import Bookmarks</h4>\nWould you like to import all existing bookmarks?"),modalImport.find(".progress").removeClass("active"),modalImportYes.removeClass("disabled")};bookmarkURL[0].oninput=validateURL,$(".button-collapse").sideNav(),$("#settings").click(function(){modalSettings.openModal()}),searchTerm.change(function(){}),searchIcon.children().first().click(function(){searchIcon.hasClass("active")?(searchTerm.blur(),setTimeout(function(){searchIcon.removeClass("active")},100),setTimeout(function(){searchTerm.val("")},500)):(searchIcon.addClass("active"),setTimeout(function(){searchTerm.focus()},300))}),$(".fixed-action-btn").find("a.btn-floating").click(function(){modalSaveContainer.openModal(),modalSaveProgress.removeClass("active"),modalSave.addClass("disabled")}),$("#add-form").submit(function(){modalSave.click(),event.preventDefault()}),datePicker.pickadate({selectMonths:!0,selectYears:15}),tabs.children().eq(1).click(function(){return tabs.children().eq(1).find("a").hasClass("active")?(datePicker.click(),!1):void 0}),$(document).delegate("#save-settings","click",function(){console.log(settingNumber.val()),settingAutomatic.is(":checked")?localStorage.removeItem("num"):localStorage.setItem("num",settingNumber.val())}).delegate("#import-yes","click",importBookmarks).delegate("#import","click",function(){modalSettings.closeModal({complete:function(){setTimeout(function(){modalImport.openModal({complete:resetImportModal}),importBookmarks()},10)}})}),settingAutomatic.change(function(){settingAutomatic.is(":checked")?(settingNumber.prop("disabled",!0),settingAlgorithm.prop("disabled",!0)):(settingNumber.prop("disabled",!1),settingAlgorithm.prop("disabled",!1))}).ready(function(){settingAlgorithm.material_select()}),modalSave.click(function(){if(!modalSave.hasClass("disabled")){modalSave.addClass("disabled"),modalSaveProgress.addClass("active");var e=bookmarkURL.val();e.match(/https?:\/\//)||(e="http://"+e);var a=new XMLHttpRequest;a.open("GET",e),a.onerror=function(e){console.log(e)},a.onload=function(){var o=new Worker(chrome.runtime.getURL("crx/worker.js")),t="s",s=a.response.match(/<title>(.+)<\/title>/);o.postMessage(JSON.stringify([a.response.split("<body")[1].split("</body")[0].replace(/<[^>]*>/g,"").match(/\w+/g).join(" "),s?s[1]:e,1.1])),o.onmessage=function(a){console.log(a.data);var o=chrome.storage.sync.get("pages",function(o){var l=[];o.pages&&(l=o.pages),console.log(l);var n=e.split("://")[1].split("#")[0];if(l.indexOf(n)<0){l.push(n),console.log(chrome.storage.sync.set({pages:l}));var i={},r=JSON.parse(a.data),d=location.origin.split("://")[1].split("."),c=new Date;r.push(d[d.length-2]+":30.0"),i[n]=[r,s?s[1]:e,t,c.getMonth()+1+"/"+(c.getDay()+1)+"/"+(c.getYear()-100)],chrome.storage.sync.set(i),toast("Page saved.",1e3)}else toast("Already saved.",1e3)})}},a.send(),addCard(e,void 0,e),bookmarkURL.val(""),modalSaveContainer.closeModal()}}),null===localStorage.getItem("run-once")&&(modalImport.openModal({complete:resetImportModal}),localStorage.setItem("run-once",!0));