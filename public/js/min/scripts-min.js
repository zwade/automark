var columns=[$("#col1"),$("#col2"),$("#col3")],categories=$("#categories"),numCards=0,bookmarkURL=$("#new-url"),saveModal=$("#save-bookmark"),saveModalContainer=$("#modal-add"),saveModalProgress=saveModalContainer.find(".progress"),importModal=$("#modal-import"),tabs=$(".tabs"),datePicker=$(".datepicker"),urlRegEx=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.!\/\\\w]*))?)/g,settingAutomatic=$("#automatic-quantity"),settingAlgorithm=$("#sorting-algorithm"),settingNumber=$("#folder-quantity"),addCard=function(a,e,o){var t="<img src='"+e+"'/>";void 0===e&&(t='<div class="bookmark-icon"><i class="mdi-action-bookmark-outline"></i></div>'),columns[numCards%3].append("<a href='"+o+"' target='_blank'><div class='card small'><div class='card-image fill-card'>"+t+"<span class='card-title'>"+a+"</span></div></div></a>");var s=columns[numCards%3].children().last().children();s.scrollfire({onBottomIn:function(a){$(a).addClass("active")}}).scrollfire({onBottomHidden:function(a){$(a).removeClass("active")}});var i=$(window);i.scrollTop()+i.height()>=s.offset().top&&s.addClass("active"),numCards++},addCards=function(a){a.forEach(function(a){addCard(a[0],a[1],a[2])})},addCategory=function(a,e){$("#"+e).append("<li><a class='"+e+"' type='"+a+"' href='#"+a+"'>"+a+"</a></li>")},removeCards=function(){numCards=0,columns.forEach(function(a){a.empty()})},validateURL=function(){!saveModalProgress.hasClass("active")&&bookmarkURL.val().match(urlRegEx)?saveModal.removeClass("disabled"):saveModal.addClass("disabled")};bookmarkURL[0].oninput=validateURL,saveModal.click(function(){if(!saveModal.hasClass("disabled")){saveModal.addClass("disabled"),saveModalProgress.addClass("active");var a=bookmarkURL.val();a.match(/http:\/\//)||a.match(/https:\/\//)||(a="http://"+a);var e=new XMLHttpRequest;console.log(a),e.open("GET",a),e.onerror=function(a){console.log(a)},e.onload=function(){var o=new Worker(chrome.runtime.getURL("crx/worker.js")),t="s",s=e.response.match(/<title>(.+)<\/title>/);o.postMessage(JSON.stringify([e.response.split("<body")[1].split("</body")[0].replace(/<[^>]*>/g,"").match(/\w+/g).join(" "),s?s[1]:a,1.1])),o.onmessage=function(e){console.log(e.data);var o=chrome.storage.sync.get("pages",function(o){var i=[];o.pages&&(i=o.pages),console.log(i);var l=a.split("://")[1].split("#")[0];if(i.indexOf(l)<0){i.push(l),console.log(chrome.storage.sync.set({pages:i}));var n={},d=JSON.parse(e.data),r=location.origin.split("://")[1].split("."),c=new Date;d.push(r[r.length-2]+":30.0"),n[l]=[d,s?s[1]:a,t,c.getMonth()+1+"/"+(c.getDay()+1)+"/"+(c.getYear()-100)],chrome.storage.sync.set(n)}})}},e.send(),addCard(a,void 0,a),bookmarkURL.val(""),$("#modal-add").closeModal()}}),$(".fixed-action-btn").find("a.btn-floating").click(function(){saveModalContainer.openModal(),saveModalProgress.removeClass("active"),saveModal.addClass("disabled")}),$("#add-form").submit(function(){saveModal.click(),event.preventDefault()}),datePicker.pickadate({selectMonths:!0,selectYears:15}),tabs.children().eq(1).click(function(){return tabs.children().eq(1).find("a").hasClass("active")?(datePicker.click(),!1):void 0}),$(document).delegate("#save-settings","click",function(){console.log(settingNumber.val()),settingAutomatic.is(":checked")?localStorage.removeItem("num"):localStorage.setItem("num",settingNumber.val())}),$(document).delegate("#import-yes","click",function(){importModal.find(".modal-content").html("<h4>Importing Bookmarks</h4>"),importModal.find(".progress").addClass("active"),$("#import-yes").addClass("disabled")}),settingAutomatic.change(function(){settingAutomatic.is(":checked")?(settingNumber.prop("disabled",!0),settingAlgorithm.prop("disabled",!0)):(settingNumber.prop("disabled",!1),settingAlgorithm.prop("disabled",!1))}),$(document).ready(function(){settingAlgorithm.material_select()}),null===localStorage.getItem("run-once")&&(importModal.openModal(),localStorage.setItem("run-once",!0));